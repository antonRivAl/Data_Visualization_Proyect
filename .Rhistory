# Airports
airports <- read.table("data/airports.dat.txt", header = FALSE, sep=",",
na.strings = "\\N")
# Asignamos nombres manualmente según la descripción del dataset
colnames(airports) <- c("AirportID", "Name", "City", "Country", "IATA", "ICAO",
"Latitude", "Longitude", "Altitude", "Timezone", "DST",
"Tz_db_time", "Type", "Source")
airports
# Airlines
airlines <- read.table("data/airlines.dat.txt", header = FALSE, sep=",",
na.strings = "\\N")
# Asignamos nombres manualmente
colnames(airlines) <- c("AirlineID", "Name", "Alias", "IATA", "ICAO",
"Callsign", "Country", "Active")
airlines
# The first row looks like an example as the AirlineID is -1. We are going to
# remove this sample
airlines = airlines[-1,]
# Flights
summary(flights)
# There are several null values in the data
dim(flights)
# There are several null values in the data. We are going to remove them.
flights = na.omit(flights)
dim(flights)
# The dimensions of this dataset is 327346 rows and 21 columns
# Finally, we are going to rename the column "name" to "FlightAirlineName"
flights <- flights %>% rename(FlightAirlineName = name)
# Airports
summary(airports)
any(is.na(airports)) # The null values correspond to the columns encoded as
# characters
airports = na.omit(airports)
dim(airports)
# This dataset has 5515 rows and 14 columns
# We are going to rename "name", "IATA", "ICAO", "City" and "Country" to
# "AirportName", "AirportIATA", "AirportICAO", "AirportCity" and "AirportCountry"
airports <- airports %>% rename(AirportName = Name, AirportIATA = IATA,
AirportICAO = ICAO, AirportCity = City,
AirportCountry = Country)
# Airlines
summary(airlines)
any(is.na(airlines)) # Once more, the nulls are related to the columns encoded
# as characters
airlines = na.omit(airlines)
dim(airlines)
# This dataset has 497 rows and 8 columns
# We are going to rename "Name", "IATA", "ICAO" and "Country" with an "Airline"
# prefix
airlines <- airlines %>% rename(AirlineName = Name, AirlineIATA = IATA,
AirlineICAO = ICAO, AirlineCountry = Country)
# We are going to save the final datasets
save(flights, file = "data/flights_final.RData")
save(airports, file = "data/airports_final.RData")
save(airlines, file = "data/airlines_final.RData")
summary(flights)
# -----------------------------------------------------------------------------
# Libraries
# -----------------------------------------------------------------------------
library(shiny)
library(shinydashboard)
library(dplyr)
library(readr)
library(tidyr)
library(ggplot2)
library(leaflet)
# -----------------------------------------------------------------------------
# Load the datasets
# -----------------------------------------------------------------------------
# Flights
flights <- read.table("data/flights.csv", header = TRUE, sep=",")
flights
# Airports
airports <- read.table("data/airports.dat.txt", header = FALSE, sep=",",
na.strings = "\\N")
# Asignamos nombres manualmente según la descripción del dataset
colnames(airports) <- c("AirportID", "Name", "City", "Country", "IATA", "ICAO",
"Latitude", "Longitude", "Altitude", "Timezone", "DST",
"Tz_db_time", "Type", "Source")
airports
# Airlines
airlines <- read.table("data/airlines.dat.txt", header = FALSE, sep=",",
na.strings = "\\N")
# Asignamos nombres manualmente
colnames(airlines) <- c("AirlineID", "Name", "Alias", "IATA", "ICAO",
"Callsign", "Country", "Active")
airlines
# The first row looks like an example as the AirlineID is -1. We are going to
# remove this sample
airlines = airlines[-1,]
# -----------------------------------------------------------------------------
# Cleaning and preprocessing
# -----------------------------------------------------------------------------
# Flights
summary(flights)
# There are several null values in the data.
dim(flights)
# The dimensions of this dataset is 3367766 rows and 21 columns
# Finally, we are going to rename the column "name" to "FlightAirlineName"
flights <- flights %>% rename(FlightAirlineName = name)
# Airports
summary(airports)
any(is.na(airports)) # The null values correspond to the columns encoded as
# characters
dim(airports)
# This dataset has 7698 rows and 14 columns
# We are going to rename "name", "IATA", "ICAO", "City" and "Country" to
# "AirportName", "AirportIATA", "AirportICAO", "AirportCity" and "AirportCountry"
airports <- airports %>% rename(AirportName = Name, AirportIATA = IATA,
AirportICAO = ICAO, AirportCity = City,
AirportCountry = Country)
# Airlines
summary(airlines)
any(is.na(airlines)) # Once more, the nulls are related to the columns encoded
# as characters
dim(airlines)
# This dataset has 6161 rows and 8 columns
# We are going to rename "Name", "IATA", "ICAO" and "Country" with an "Airline"
# prefix
airlines <- airlines %>% rename(AirlineName = Name, AirlineIATA = IATA,
AirlineICAO = ICAO, AirlineCountry = Country)
# There are null values in all the datasets. We need to be aware of it and maybe
# use some filters in the visualizations.
# -----------------------------------------------------------------------------
# Save the final data
# -----------------------------------------------------------------------------
# We are going to save the final datasets
save(flights, file = "data/flights_final.RData")
save(airports, file = "data/airports_final.RData")
save(airlines, file = "data/airlines_final.RData")
library(shiny)
library(dplyr)
library(ggplot2)
library(scales)
library(shinydashboard)
library(leaflet)
library(shinyWidgets)
load("data/flights_final.RData")
load("data/airports_final.RData")
load("data/airlines_final.RData")
unique_airlines <- sort(unique(flights$FlightAirlineName))
unique_origins <- sort(unique(flights$origin))
ui <- dashboardPage(
# Header
dashboardHeader(title = "Flight Analytics Tool"),
# Sidebar
dashboardSidebar(
sidebarMenu(
menuItem("Temporal Delays", tabName = "temporal", icon = icon("clock")),
menuItem("Geographic Routes", tabName = "map", icon = icon("globe")),
menuItem("Airline Performance", tabName = "performance", icon = icon("chart-bar"))
)
),
# Body
dashboardBody(
tabItems(
# First plot - Temporal Analysis
tabItem(
tabName = "temporal",
fluidRow(
box(
title = "Filters", status = "primary", solidHeader = TRUE, width = 3,
selectInput("temp_granularity", "Temporal Granularity:",
choices = list("Hour" = "hour",
"Day" = "weekday",
"Month" = "month")),
radioButtons("temp_analysis_type", "Analyze by:",
choices = c("Airline", "Origin Airport"),
selected = "Airline"),
uiOutput("temp_filter_ui"),
radioButtons("temp_view", "Visualization Type:",
choices = list("Trend (Line)" = "line",
"Heatmap" = "heatmap"))
),
box(
title = "Delay Evolution", status = "primary", solidHeader = TRUE, width = 9,
plotOutput("temporalPlot", height = "500px")
)
),
#fluidRow(
#  box(
#    width = 12, title = "Analysis Description",
#    "This chart allows you to analyze delay patterns. Select the granularity to see if delays accumulate at specific hours, months, or days."
#  )
#)
),
# --- TAB 2: Geographic Map ---
tabItem(
tabName = "map",
fluidRow(
box(
title = "Map Configuration", status = "success", solidHeader = TRUE, width = 3,
selectInput("map_airline", "Airline:",
choices = c("All", unique_airlines),
selected = "All"),
# NEW: Date and Time Selector (Range)
airDatepickerInput(
inputId = "map_datetime_range",
label = "Select Date Range:",
range = TRUE,
timepicker = FALSE,       # <--- CHANGE: Time deactivated
placeholder = "Start - End",
dateFormat = "yyyy-MM-dd", # Clean format
value = c("2013-01-01", "2013-01-31"),
minDate = "2013-01-01",
maxDate = "2013-12-31"
)
),
box(
title = "Route Distribution", status = "success", solidHeader = TRUE, width = 9,
leafletOutput("routesMap", height = "600px")
)
)
),
# --- TAB 3: Performance Comparison ---
tabItem(
tabName = "performance",
fluidRow(
box(
title = "Comparison Metrics", status = "warning", solidHeader = TRUE, width = 3,
selectInput("perf_x_axis", "X Axis (Metric 1):",
choices = list("Number of Flights" = "count",
"Average Distance" = "distance",
"Avg Departure Delay" = "dep_delay",
"Avg Arrival Delay" = "arr_delay",
"Efficiency (Miles/Min)" = "efficiency",
"Avg Flight Time" = "air_time")),
selectInput("perf_y_axis", "Y Axis (Metric 2):",
choices = list("Avg Arrival Delay" = "arr_delay",
"Efficiency (Miles/Min)" = "efficiency",
"Avg Flight Time" = "air_time",
"Number of Flights" = "count",
"Average Distance" = "distance",
"Avg Departure Delay" = "dep_delay"),
selected = "efficiency")
),
box(
title = "Airline Comparison", status = "warning", solidHeader = TRUE, width = 9,
plotOutput("performancePlot", height = "500px")
)
)
)
)
),
skin = "blue"
)
server <- function(input, output, session) {
# --------------------------------------------------------------------------
# Event Reactions
# --------------------------------------------------------------------------
# VIS_1: Render dynamic selector (Airlines or Airports)
output$temp_filter_ui <- renderUI({
# Define picker style options
picker_options <- list(
`actions-box` = TRUE,
`live-search` = TRUE, # Allows searching by typing
`selected-text-format` = "count > 3" # If more than 3, displays "4 items selected" to save space
)
if (input$temp_analysis_type == "Airline") {
pickerInput(
inputId = "temp_selection",
label = "Select Airline(s):",
choices = unique_airlines,
multiple = TRUE,
selected = unique_airlines[1], # Select first by default
options = picker_options
)
} else {
pickerInput(
inputId = "temp_selection",
label = "Select Airport(s):",
choices = unique_origins,
multiple = TRUE,
selected = unique_origins[1], # Select first by default
options = picker_options
)
}
})
# VIS_1: Filtered Dataset
filtered_flights <- reactive({
req(input$temp_selection) # Wait for user selection
data <- flights
# Filter depending on Airline or Airport mode
if (input$temp_analysis_type == "Airline") {
data <- data %>%
filter(FlightAirlineName %in% input$temp_selection) %>%
mutate(group_col = FlightAirlineName) # Create generic column for grouping
} else {
data <- data %>%
filter(origin %in% input$temp_selection) %>%
mutate(group_col = origin) # Create generic column
}
return(data)
})
# VIS_1: Aggregated Dataset
aggregated_data <- reactive({
req(input$temp_granularity)
data <- filtered_flights()
granularity <- input$temp_granularity
if (granularity == "hour") {
# Group by hour
summary_data <- data %>%
group_by(group_col, hour) %>%
summarise(avg_delay = mean(dep_delay, na.rm = TRUE), .groups = "drop") %>%
rename(time_unit = hour)
} else if (granularity == "month") {
# Group by month (TRANSFORM TO TEXT)
summary_data <- data %>%
group_by(group_col, month) %>%
summarise(avg_delay = mean(dep_delay, na.rm = TRUE), .groups = "drop") %>%
# Convert month number to Name (Jan, Feb...)
mutate(time_unit = month.abb[month])
# Force month order (to avoid alphabetical sorting)
summary_data$time_unit <- factor(summary_data$time_unit, levels = month.abb)
} else { # weekday
summary_data <- data %>%
mutate(full_date = as.Date(paste(year, month, day, sep = "-")),
weekday_num = as.numeric(format(full_date, "%u")),
weekday_label = format(full_date, "%a")) %>%
group_by(group_col, weekday_num, weekday_label) %>%
summarise(avg_delay = mean(dep_delay, na.rm = TRUE), .groups = "drop") %>%
arrange(weekday_num) %>%
rename(time_unit = weekday_label)
summary_data$time_unit <- factor(summary_data$time_unit, levels = unique(summary_data$time_unit))
}
return(summary_data)
})
# VIS_2: Prepare ROUTE data (Graph edges)
map_routes_data <- reactive({
req(input$map_datetime_range)
# Request days from user, but internally add time to cover the full day
start_date <- as.POSIXct(paste0(input$map_datetime_range[1], " 00:00:00"))
end_date   <- as.POSIXct(paste0(input$map_datetime_range[2], " 23:59:59"))
# 1. Filter
data <- flights %>%
mutate(flight_datetime = as.POSIXct(time_hour, format="%Y-%m-%d %H:%M:%S")) %>%
filter(flight_datetime >= start_date & flight_datetime <= end_date)
if (input$map_airline != "All") {
data <- data %>% filter(FlightAirlineName == input$map_airline)
}
# 2. Group and Top 100
routes <- data %>%
group_by(origin, dest) %>%
summarise(
num_flights = n(),
mean_time = mean(air_time, na.rm=T),
.groups = "drop"
) %>%
arrange(desc(num_flights)) %>%
slice_head(n = 100)
# 3. Coordinates
routes <- routes %>%
left_join(airports %>% select(AirportIATA, Latitude, Longitude),
by = c("origin" = "AirportIATA")) %>%
rename(lat_org = Latitude, lon_org = Longitude) %>%
left_join(airports %>% select(AirportIATA, Latitude, Longitude),
by = c("dest" = "AirportIATA")) %>%
rename(lat_dst = Latitude, lon_dst = Longitude) %>%
filter(!is.na(lat_org) & !is.na(lat_dst))
return(routes)
})
# VIS_2: Prepare AIRPORT data (Graph nodes)
map_airports_data <- reactive({
routes <- map_routes_data()
airports_stats <- routes %>%
group_by(origin, lat_org, lon_org) %>%
summarise(total_departures = sum(num_flights), .groups = "drop")
return(airports_stats)
})
# VIS_3: Prepare KPI data by Airline
performance_data <- reactive({
# Take clean dataset and group by airline
kpi_df <- flights %>%
group_by(FlightAirlineName) %>%
summarise(
# Metric 1: Total volume
count = n(),
# Metric 2: Avg distance
distance = mean(distance, na.rm = TRUE),
# Metric 3: Avg air time
air_time = mean(air_time, na.rm = TRUE),
# Metric 4: Avg Departure Delay
dep_delay = mean(dep_delay, na.rm = TRUE),
# Metric 5: Avg Arrival Delay
arr_delay = mean(arr_delay, na.rm = TRUE),
# Metric 6: Efficiency (Miles per minute of flight)
efficiency = sum(distance, na.rm=T) / sum(air_time, na.rm=T),
# Metric 7: Delay Rate (% of flights arriving >15 min late)
delay_rate = mean(arr_delay > 15, na.rm = TRUE) * 100,
.groups = "drop"
) %>%
# Filter very small airlines to avoid statistical noise
filter(count > 100)
return(kpi_df)
})
# --------------------------------------------------------------------------
# CHARTS (Outputs)
# --------------------------------------------------------------------------
# Visualization 1 (VIS_1): Temporal Chart
output$temporalPlot <- renderPlot({
df <- aggregated_data()
view_type <- input$temp_view
granularity <- input$temp_granularity
# Dynamic title and labels
entity_name <- input$temp_analysis_type # "Airline" or "Origin Airport"
plot_title <- paste("Average departure delay by", granularity)
p <- ggplot(df, aes(x = time_unit, y = avg_delay)) +
labs(title = plot_title,
x = "Time",
y = "Average Delay (min)",
color = entity_name,
fill = "Delay") +
theme_minimal() +
theme(plot.title = element_text(size = 16, face = "bold"),
axis.text = element_text(size = 12))
# FIX: If hour, force all X axis ticks
if (granularity == "hour") {
p <- p + scale_x_continuous(breaks = 0:23)
}
if (view_type == "line") {
p +
geom_line(aes(color = group_col, group = group_col), linewidth = 1) +
geom_point(aes(color = group_col), size = 2) +
geom_hline(yintercept = 0, linetype = "dashed", color = "gray")
} else {
p +
geom_tile(aes(y = group_col, fill = avg_delay), color = "white") +
scale_fill_viridis_c(option = "magma", direction = -1) +
labs(y = entity_name)
}
})
# Visualization 2 (VIS_2): Interactive Map
output$routesMap <- renderLeaflet({
routes <- map_routes_data()
nodes <- map_airports_data()
map <- leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
setView(lng = -96, lat = 37.8, zoom = 4)
pal_lines <- colorNumeric(palette = "YlOrRd", domain = routes$mean_time)
# Draw Lines
if(nrow(routes) > 0) {
for(i in 1:nrow(routes)){
map <- map %>%
addPolylines(
lng = c(routes$lon_org[i], routes$lon_dst[i]),
lat = c(routes$lat_org[i], routes$lat_dst[i]),
color = pal_lines(routes$mean_time[i]),
weight = 1.5,
opacity = 0.5,
popup = paste("Route:", routes$origin[i], "-", routes$dest[i])
)
}
}
# Draw Circles (Logarithmic sizing)
map <- map %>%
addCircleMarkers(
data = nodes,
lng = ~lon_org, lat = ~lat_org,
# log(x + 1) flattens the curve. Multiply by 3 for a visible base size.
radius = ~log(total_departures + 1) * 3,
color = "#0073e6",
fillOpacity = 0.8,
stroke = FALSE,
popup = ~paste("<b>Airport:</b>", origin, "<br>",
"<b>Departures in period:</b>", total_departures)
) %>%
addLegend("bottomright", pal = pal_lines, values = routes$mean_time,
title = "Flight Time (min)", opacity = 1)
return(map)
})
# Visualization 3 (VIS_3): Scatter Plot
output$performancePlot <- renderPlot({
df <- performance_data()
# Capture variables
x_var <- input$perf_x_axis
y_var <- input$perf_y_axis
# Axis labels mapping
axis_names <- c(
"count" = "Total Number of Flights",
"distance" = "Average Distance (miles)",
"dep_delay" = "Avg Departure Delay (min)",
"arr_delay" = "Avg Arrival Delay (min)",
"efficiency" = "Efficiency (Miles/Min)",
"air_time" = "Average Flight Time (min)"
)
# Build chart
ggplot(df, aes(x = .data[[x_var]], y = .data[[y_var]])) +
# POINTS
geom_point(aes(size = count, color = FlightAirlineName),
alpha = 0.7) +
# LABELS: Airline names
geom_text(aes(label = FlightAirlineName),
vjust = -1, linewidth = 3, check_overlap = FALSE) +
scale_size_continuous(range = c(3, 18), name = "Flight Volume") +
guides(
color = "none",   # Hide name color legend
size = "legend"   # Show size legend
) +
labs(
title = paste("Analysis:", axis_names[x_var], "vs", axis_names[y_var]),
subtitle = "Point size indicates flight volume.",
x = axis_names[x_var],
y = axis_names[y_var]
) +
theme_light() +
theme(
plot.title = element_text(size = 18, face = "bold"),
axis.title = element_text(size = 14)
)
})
}
shinyApp(ui, server)
